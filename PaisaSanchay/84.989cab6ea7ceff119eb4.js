(self.webpackChunkpaisa_sanchay=self.webpackChunkpaisa_sanchay||[]).push([[84],{2084:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ReportModule:()=>z});var r=i(1116),n=i(3337),o=i(5366),a=i(1458),l=i(9199),c=i(1041),s=i(5204),m=i(529),u=i(1039);let p=(()=>{class e{constructor(e){this.http=e}getreport(e){return this.http.httpGet(`${m.N.api}collectionReports/all?`,e)}downloadReport(e){return this.http.httpGet(`${m.N.api}collectionReports/download?`,e)}}return e.\u0275fac=function(t){return new(t||e)(o.LFG(u.m))},e.\u0275prov=o.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var d=i(3070),h=i(9550),f=i(9024),Z=i(3841),g=i(7064),v=i(4155),A=i(4369);function w(e,t){if(1&e&&(o.TgZ(0,"mat-option",36),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.Q6J("value",e.id),o.xp6(1),o.hij(" ",e.name," ")}}function b(e,t){if(1&e&&(o.TgZ(0,"mat-option",36),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.Q6J("value",e.id),o.xp6(1),o.hij(" ",e.username," ")}}function q(e,t){if(1&e&&(o.TgZ(0,"div",37),o.TgZ(1,"div",38),o.TgZ(2,"div",1),o.TgZ(3,"div",39),o.TgZ(4,"div",40),o.TgZ(5,"div",1),o.TgZ(6,"div",41),o.TgZ(7,"b"),o._uU(8),o.qZA(),o.qZA(),o.TgZ(9,"div",41),o.TgZ(10,"b"),o._uU(11),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA(),o.qZA()),2&e){const e=o.oxw();o.xp6(8),o.hij("Debit: ",e.total.debit,""),o.xp6(3),o.hij("Credit: ",e.total.credit,"")}}function T(e,t){1&e&&(o.TgZ(0,"mat-header-cell"),o._uU(1," Voucher Number "),o.qZA())}function S(e,t){if(1&e&&(o.TgZ(0,"mat-cell"),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.xp6(1),o.hij(" ",null==e?null:e.id," ")}}function D(e,t){1&e&&(o.TgZ(0,"mat-header-cell"),o._uU(1," Member ID "),o.qZA())}function _(e,t){if(1&e&&(o.TgZ(0,"mat-cell"),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.xp6(1),o.hij(" ",null==e?null:e.memberid," ")}}function x(e,t){1&e&&(o.TgZ(0,"mat-header-cell",42),o._uU(1," Member Name "),o.qZA())}function y(e,t){if(1&e&&(o.TgZ(0,"mat-cell",42),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.xp6(1),o.hij(" ",null==e?null:e.member," ")}}function U(e,t){1&e&&(o.TgZ(0,"mat-header-cell"),o._uU(1," User Name "),o.qZA())}function N(e,t){if(1&e&&(o.TgZ(0,"mat-cell"),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.xp6(1),o.hij(" ",null==e?null:e.user," ")}}function C(e,t){1&e&&(o.TgZ(0,"mat-header-cell"),o._uU(1," Amount "),o.qZA())}function k(e,t){if(1&e&&(o.TgZ(0,"mat-cell"),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.xp6(1),o.hij(" ",null==e?null:e.amount," ")}}function Y(e,t){1&e&&(o.TgZ(0,"mat-header-cell"),o._uU(1," Date "),o.qZA())}function O(e,t){if(1&e&&(o.TgZ(0,"mat-cell"),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.xp6(1),o.hij(" ",null==e?null:e.transactiondate," ")}}function F(e,t){1&e&&(o.TgZ(0,"mat-header-cell"),o._uU(1," Operation "),o.qZA())}function Q(e,t){if(1&e&&(o.TgZ(0,"mat-cell"),o._uU(1),o.qZA()),2&e){const e=t.$implicit;o.xp6(1),o.hij(" ",null==e?null:e.operation," ")}}function J(e,t){1&e&&o._UZ(0,"mat-header-row")}function j(e,t){1&e&&o._UZ(0,"mat-row")}let M=(()=>{class e{constructor(e,t,i,r){this.fb=e,this.homeService=t,this.spinnerService=i,this.reportService=r,this.displayedColumns=["Voucher_number","date","member_card_number","member_name","user_name","amount","operation"],this.dataSource=new l.by([]),this.now=new Date,this.operation=[{id:"All",name:"All"},{id:"Receipt",name:"Receipt"},{id:"Payment",name:"Payment"},{id:"Opening balance",name:"Opening balance"}],this.collectionMode=[{id:"All",name:"All"},{id:"loan",name:"Loan"},{id:"mdtwf",name:"MDTWF"},{id:"subscription",name:"Subscription"},{id:"kuri",name:"Kuri"}],this.filterOptions={operation:[...this.operation],collectionMode:[...this.collectionMode],userid:[]},this.selectOptions={operation:[...this.operation],collectionMode:[...this.collectionMode],userid:[]},this.oldSelects={},this.searchKeyMapping={operation:"name",collectionMode:"name",userid:"username"}}ngOnInit(){this.getUsers(),this.filterForm=this.createFilterForm();for(let e in this.filterForm.controls)-1!=e.indexOf("Search")&&this.filterForm.controls[e].valueChanges.subscribe(t=>{this.filter(e,t)})}getUsers(){this.spinnerService.showSpinner(),this.homeService.getUsers().subscribe(e=>{e.users.unshift({id:"All",username:"All"}),this.filterOptions.userid=e.users,this.selectOptions.userid=e.users,this.spinnerService.hideSpinner()},e=>{this.filterOptions.userid=[],this.selectOptions.userid=[],this.spinnerService.hideSpinner()})}createFilterForm(){return this.fb.group({fromDate:[new Date],toDate:[new Date],operation:[],collectionMode:[],userid:[],useridSearch:[""]})}filter(e,t){var i;null!=t&&(this.filterOptions[e.split("Search")[0]]=null===(i=this.selectOptions[e.split("Search")[0]])||void 0===i?void 0:i.filter(i=>{var r;return null===(r=i[this.searchKeyMapping[e.split("Search")[0]]])||void 0===r?void 0:r.toLowerCase().includes(t.toLowerCase())}))}runReport(){this.spinnerService.showSpinner(),this.reportService.getreport(this.payload()).subscribe(e=>{var t;this.dataSource=new l.by(null===(t=null==e?void 0:e.result)||void 0===t?void 0:t.results.map(e=>(e.transactiondate=e.transactiondate.substring(8,10)+"-"+e.transactiondate.substring(5,7)+"-"+e.transactiondate.substring(0,4),e))),this.total=e.result.totalBalance,this.spinnerService.hideSpinner()},e=>{this.dataSource=new l.by([]),this.spinnerService.hideSpinner()})}downloadReport(){this.spinnerService.showSpinner(),this.reportService.downloadReport(this.payload()).subscribe(e=>{console.log(e),this.spinnerService.hideSpinner()},e=>{console.log(e),this.spinnerService.hideSpinner()})}payload(){let e={};const t=Object.assign(Object.assign({},this.filterForm.value),{fromDate:this.formatDate(this.filterForm.value.fromDate),toDate:this.formatDate(this.filterForm.value.toDate)});for(var i of(delete t.transactionSearch,delete t.collectionSearch,delete t.useridSearch,Object.keys(t)))null!=t[i]&&(e[i]=t[i]);return e}resetFilter(){this.filterForm.reset(),this.filterForm.controls.fromDate.setValue(new Date),this.filterForm.controls.toDate.setValue(new Date),this.filterForm.updateValueAndValidity(),this.runReport()}formatDate(e){let t=new Date(e),i=""+(t.getMonth()+1),r=""+t.getDate(),n=t.getFullYear();return i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),[n,i,r].join("-")}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(c.qu),o.Y36(a.Y),o.Y36(s.V),o.Y36(p))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-report-view"]],decls:61,vars:13,consts:[[1,"card-container",3,"formGroup"],[1,"row"],[1,"col-6","col-lg-2","col-lg-2"],[1,"input-field","w-100"],["matInput","","placeholder","start date","formControlName","fromDate",3,"matDatepicker"],["matSuffix","",3,"for"],["picker1",""],[1,"col-6","col-lg-2"],["matInput","","placeholder","end Date","formControlName","toDate",3,"matDatepicker"],["picker2",""],[1,"mt-2","mt-lg-0","w-100"],["formControlName","operation","placeholder","Select operation type",3,"multiple"],["transactionType",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","userid","placeholder","Select user",3,"multiple"],["usercntrl",""],["formControlName","useridSearch","placeholderLabel","search payment option","noEntriesFoundLabel","No search result found"],["mat-raised-button","","color","primary",1,"close","mt-2","mt-lg-0",3,"click"],[1,"row","justify-content-end"],["class","col-12 col-lg-4",4,"ngIf"],[1,"card-container","mt-4"],[1,"row","report"],[1,"mat-elevation-z8","report",3,"dataSource"],["matColumnDef","Voucher_number"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","member_card_number"],["matColumnDef","member_name"],["class","w-10",4,"matHeaderCellDef"],["class","w-10",4,"matCellDef"],["matColumnDef","user_name"],["matColumnDef","amount"],["matColumnDef","date",1,"text-center"],["matColumnDef","operation"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[3,"value"],[1,"col-12","col-lg-4"],[1,"container","mt-2","mt-lg-0"],[1,"card","py-1"],[1,"card-body","p-1","text-center"],[1,"col-6"],[1,"w-10"]],template:function(e,t){if(1&e&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.TgZ(2,"div",2),o.TgZ(3,"mat-form-field",3),o._UZ(4,"input",4),o._UZ(5,"mat-datepicker-toggle",5),o._UZ(6,"mat-datepicker",null,6),o.qZA(),o.qZA(),o.TgZ(8,"div",7),o.TgZ(9,"mat-form-field",3),o._UZ(10,"input",8),o._UZ(11,"mat-datepicker-toggle",5),o._UZ(12,"mat-datepicker",null,9),o.qZA(),o.qZA(),o.TgZ(14,"div",7),o.TgZ(15,"mat-form-field",10),o.TgZ(16,"mat-select",11,12),o.YNc(18,w,2,2,"mat-option",13),o.qZA(),o.qZA(),o.qZA(),o.TgZ(19,"div",7),o.TgZ(20,"mat-form-field",10),o.TgZ(21,"mat-select",14,15),o.TgZ(23,"mat-option"),o._UZ(24,"ngx-mat-select-search",16),o.qZA(),o.YNc(25,b,2,2,"mat-option",13),o.qZA(),o.qZA(),o.qZA(),o.TgZ(26,"div",7),o.TgZ(27,"button",17),o.NdJ("click",function(){return t.resetFilter()}),o._uU(28,"Reset Filter"),o.qZA(),o.qZA(),o.qZA(),o.TgZ(29,"div",18),o.YNc(30,q,12,2,"div",19),o.TgZ(31,"div",7),o.TgZ(32,"button",17),o.NdJ("click",function(){return t.runReport()}),o._uU(33,"Run Report"),o.qZA(),o.qZA(),o._UZ(34,"div",7),o.qZA(),o.qZA(),o.TgZ(35,"div",20),o.TgZ(36,"div",21),o.TgZ(37,"mat-table",22),o.ynx(38,23),o.YNc(39,T,2,0,"mat-header-cell",24),o.YNc(40,S,2,1,"mat-cell",25),o.BQk(),o.ynx(41,26),o.YNc(42,D,2,0,"mat-header-cell",24),o.YNc(43,_,2,1,"mat-cell",25),o.BQk(),o.ynx(44,27),o.YNc(45,x,2,0,"mat-header-cell",28),o.YNc(46,y,2,1,"mat-cell",29),o.BQk(),o.ynx(47,30),o.YNc(48,U,2,0,"mat-header-cell",24),o.YNc(49,N,2,1,"mat-cell",25),o.BQk(),o.ynx(50,31),o.YNc(51,C,2,0,"mat-header-cell",24),o.YNc(52,k,2,1,"mat-cell",25),o.BQk(),o.ynx(53,32),o.YNc(54,Y,2,0,"mat-header-cell",24),o.YNc(55,O,2,1,"mat-cell",25),o.BQk(),o.ynx(56,33),o.YNc(57,F,2,0,"mat-header-cell",24),o.YNc(58,Q,2,1,"mat-cell",25),o.BQk(),o.YNc(59,J,1,0,"mat-header-row",34),o.YNc(60,j,1,0,"mat-row",35),o.qZA(),o.qZA(),o.qZA()),2&e){const e=o.MAs(7),i=o.MAs(13);o.Q6J("formGroup",t.filterForm),o.xp6(4),o.Q6J("matDatepicker",e),o.xp6(1),o.Q6J("for",e),o.xp6(5),o.Q6J("matDatepicker",i),o.xp6(1),o.Q6J("for",i),o.xp6(5),o.Q6J("multiple",!1),o.xp6(2),o.Q6J("ngForOf",t.filterOptions.operation),o.xp6(3),o.Q6J("multiple",!1),o.xp6(4),o.Q6J("ngForOf",t.filterOptions.userid),o.xp6(5),o.Q6J("ngIf",t.dataSource.data.length),o.xp6(7),o.Q6J("dataSource",t.dataSource),o.xp6(22),o.Q6J("matHeaderRowDef",t.displayedColumns),o.xp6(1),o.Q6J("matRowDefColumns",t.displayedColumns)}},directives:[c.JL,c.sg,d.KE,h.Nt,c.Fj,f.hl,c.JJ,c.u,f.nW,d.R9,f.Mq,Z.gD,r.sg,g.ey,v.nu,A.lW,r.O5,l.BZ,l.w1,l.fO,l.Dz,l.as,l.nj,l.ge,l.ev,l.XQ,l.Gk],styles:[".close[_ngcontent-%COMP%]{position:sticky!important;width:100%;bottom:0;color:#fff;font-size:14px;font-weight:600px}.table[_ngcontent-%COMP%]{width:100%;overflow:scroll}.w-10[_ngcontent-%COMP%]{width:100px}.float[_ngcontent-%COMP%]{float:right}"]}),e})();const R=[{path:"",component:(()=>{class e{constructor(e,t){this.homeService=e,this.route=t,t.data.subscribe(t=>{e.headerSubject$.next(t.header)})}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(o.Y36(a.Y),o.Y36(n.gz))},e.\u0275cmp=o.Xpm({type:e,selectors:[["app-report"]],decls:4,vars:0,consts:[[1,"container"],[1,"row"],[1,"col-12"]],template:function(e,t){1&e&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.TgZ(2,"div",2),o._UZ(3,"app-report-view"),o.qZA(),o.qZA(),o.qZA())},directives:[M],styles:[""]}),e})(),data:{header:"Report"}}];let B=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[n.Bz.forChild(R)],n.Bz]}),e})();var $=i(1986);let z=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.oAB({type:e}),e.\u0275inj=o.cJS({imports:[[r.ez,B,$.m]]}),e})()}}]);